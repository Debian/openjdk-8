Description: Handle EXTRA_* flags into icedtea
 - Use -J-Xbootclasspath for javac of PulseAudio
 - Append $EXTRA_CFLAGS_IT to $IT_CFLAGS (use for PulseAudio native build)
 - Append $EXTRA_LDFLAGS_IT to PulseAudio native link
 - Send all EXTRA_* flags to jamvm and cacao
 - Remove `-icedtea' from the release identifier
 - Rename hotspot source and debian patches for zerovm build
Author: Damien Raude-Morvan <drazzib@debian.org>, Matthias Klose <doko@ubuntu.com>
 
--- Makefile.am.orig
+++ Makefile.am
@@ -133,7 +133,7 @@
 IT_JAVACFLAGS=$(IT_JAVAC_SETTINGS) -source $(IT_LANGUAGE_SOURCE_VERSION) -target $(IT_CLASS_TARGET_VERSION)
 
 # Flags
-IT_CFLAGS=$(CFLAGS) $(ARCHFLAG)
+IT_CFLAGS=$(CFLAGS) $(ARCHFLAG) $(EXTRA_CFLAGS_IT)
 
 # Conditional defintions
 
@@ -1477,9 +1477,6 @@
 	  echo "DISTRO_PACKAGE_VERSION=$(PKGVERSION)" \
 	    >>openjdk/jdk/make/common/shared/Defs.gmk ;
 endif
-	if test x"$(PROJECT_NAME)" != "xjdk7" && test x"$(PROJECT_NAME)" != "xicedtea"; then \
-	  proj_suffix="-$(PROJECT_NAME)"; \
-	fi ; \
 	if test x"$(VERSION_SUFFIX)" != "x"; then \
 	  ver_suffix="-$(VERSION_SUFFIX)"; \
 	fi ; \
@@ -1945,7 +1942,7 @@
 	 -I$(PULSE_JAVA_NATIVE_BUILDDIR) -o $@ -c $<
 
 $(PULSE_JAVA_NATIVE_BUILDDIR)/libpulse-java.so: $(PULSE_JAVA_NATIVE_OBJECTS)
-	$(CC) $(LDFLAGS) -shared $(PULSE_JAVA_NATIVE_OBJECTS) $(LIBPULSE_LIBS) \
+	$(CC) $(LDFLAGS) $(EXTRA_LDFLAGS_IT) -shared $(PULSE_JAVA_NATIVE_OBJECTS) $(LIBPULSE_LIBS) \
 	 -o $(PULSE_JAVA_NATIVE_BUILDDIR)/libpulse-java.so
 
 endif
@@ -2013,7 +2010,8 @@
 if BUILD_JAMVM
 	cd jamvm/jamvm && \
 	./autogen.sh --with-java-runtime-library=openjdk7 \
-	  --prefix=$(abs_top_builddir)/jamvm/install ; \
+	  --prefix=$(abs_top_builddir)/jamvm/install \
+	  CFLAGS='$(EXTRA_CFLAGS_JAMVM)' LDFLAGS='$(EXTRA_LDFLAGS_JAMVM)' CPPFLAGS='$(EXTRA_CPPFLAGS_JAMVM)' CXXFLAGS='$(EXTRA_CXXFLAGS_JAMVM)'; \
 	$(MAKE) ; \
 	$(MAKE) install
 	mkdir -p $(abs_top_builddir)/jamvm/install/hotspot/jre/lib/$(INSTALL_ARCH_DIR)/server
@@ -2082,7 +2080,8 @@
 	  --with-java-runtime-library=openjdk7 \
 	  --with-java-runtime-library-prefix=$(abs_top_builddir)/openjdk \
 	  --with-java-runtime-library-classes=$(RUNTIME) \
-	  --enable-jre-layout $(CACAO_CONFIGURE_ARGS); \
+	  --enable-jre-layout $(CACAO_CONFIGURE_ARGS) \
+	  CFLAGS='$(EXTRA_CFLAGS_CACAO)' LDFLAGS='$(EXTRA_LDFLAGS_CACAO)' CPPFLAGS='$(EXTRA_CPPFLAGS_CACAO)' CXXFLAGS='$(EXTRA_CXXFLAGS_CACAO)'; \
 	$(ARCH_PREFIX) $(MAKE) -j$(PARALLEL_JOBS) install
 	ln -sf server $(abs_top_builddir)/cacao/install/jre/lib/$(INSTALL_ARCH_DIR)/client
 	touch $(abs_top_builddir)/cacao/install/jre/lib/$(INSTALL_ARCH_DIR)/server/Xusage.txt
@@ -2158,7 +2157,7 @@
 			'--with-javac=% '--with-javac=% \
 			'--with-rmic=% '--with-additional-vms=% \
 			'--disable-bootstrap% '--enable-bootstrap% , \
-		$(CONFIGURE_ARGS)) \
+		$(subst hotspot-default.tar,hotspot-zero.tar,$(CONFIGURE_ARGS))) \
 	$(foreach i, openjdk hotspot corba jaxp jaxws jdk langtools, \
 	  $(if $(findstring --with-$(i)-src-zip=, $(CONFIGURE_ARGS)),, --with-$(i)-src-zip=$(abs_top_builddir)/$(i).tar.gz))
 
@@ -2168,7 +2167,7 @@
 	BUILD_JAXWS=false     ALT_JAXWS_DIST=$(BUILD_OUTPUT_DIR)/jaxws/dist \
 	BUILD_CORBA=false     ALT_CORBA_DIST=$(BUILD_OUTPUT_DIR)/corba/dist \
 	BUILD_JDK=false \
-	DISTRIBUTION_PATCHES='$(foreach p,$(DISTRIBUTION_PATCHES),$(if $(findstring cacao,$(p)),,$(if $(findstring jamvm,$(p)),,$(p))))'
+	DISTRIBUTION_PATCHES='$(foreach p,$(subst -default,-zero,$(DISTRIBUTION_PATCHES)),$(if $(findstring cacao,$(p)),,$(if $(findstring jamvm,$(p)),,$(p))))'
 
 stamps/add-zero.stamp: stamps/icedtea.stamp
 	mkdir -p stamps
--- patches/jamvm/remove-sun.misc.Perf-debug-code.patch
+++ patches/jamvm/remove-sun.misc.Perf-debug-code.patch
@@ -34,9 +34,9 @@
              if (resolve) {
 Index: openjdk/jdk/src/share/classes/java/util/zip/ZipFile.java
 ===================================================================
---- openjdk.orig/jdk/src/share/classes/java/util/zip/ZipFile.java	2011-06-28 18:56:56.994704556 +0200
-+++ openjdk/jdk/src/share/classes/java/util/zip/ZipFile.java	2011-06-28 18:57:11.514776567 +0200
-@@ -212,8 +212,6 @@
+--- openjdk/jdk/src/share/classes/java/util/zip/ZipFile.java~	2013-06-21 22:46:14.000000000 +0200
++++ openjdk/jdk/src/share/classes/java/util/zip/ZipFile.java	2013-06-28 17:08:07.597635788 +0200
+@@ -213,8 +213,6 @@
          this.zc = ZipCoder.get(charset);
          long t0 = System.nanoTime();
          jzfile = open(name, mode, file.lastModified(), usemmap);
@@ -44,4 +44,4 @@
 -        sun.misc.PerfCounter.getZipFileCount().increment();
          this.name = name;
          this.total = getTotal(jzfile);
-     }
+         this.locsig = startsWithLOC(jzfile);
